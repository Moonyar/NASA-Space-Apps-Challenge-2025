<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Exoplanet Classifier — Final Summary & Predictions</title>
    <style>
      :root{
        --bg:#0b1021; --bg2:#0f1530; --card:#121a3b; --card2:#0f1733;
        --text:#e9edf8; --muted:#b7c1d6; --accent:#7aa2ff; --danger:#ff6b6b;
        --radius:14px; --shadow:0 20px 50px rgba(0,0,0,.45);
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0;
        font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
        color:var(--text);
        background:
          linear-gradient(180deg, rgba(7,10,20,.55), rgba(10,14,30,.78)),
          url("{{ url_for('static', filename='fun_background.svg') }}") center/cover no-repeat fixed;
      }

      .viewport{min-height:100svh; display:grid; place-items:start center; padding:24px}
      .wrap{max-width:1080px; width:100%}

      /* Hero */
      .page-hero{padding:8px 20px 0}
      .page-hero h1{margin:0 0 6px; font-size: clamp(26px, 3.6vw, 40px); text-shadow: 0 6px 30px rgba(0,0,0,.45)}
      .tagline{color:var(--muted); margin:0 0 10px}
      .pill{
        display:inline-block; padding:6px 10px; border-radius:999px;
        background: rgba(122,162,255,.12); color:#deebff; border:1px solid rgba(122,162,255,.28);
        font-size:.85rem; backdrop-filter: blur(2px);
      }

      /* Cards & grids */
      .cards{display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:16px; padding:18px 20px 0}
      .card{
        background: linear-gradient(180deg, rgba(12,18,42,.85), rgba(11,17,38,.82));
        border:1px solid rgba(255,255,255,.08);
        border-radius: var(--radius); padding:16px 18px; box-shadow: var(--shadow);
      }
      .metric{display:flex; flex-direction:column; gap:6px}
      .metric .label{font-size:.9rem; color:var(--muted)}
      .metric .value{font-size:1.4rem; font-weight:800}

      .section{margin:18px 20px 0}
      .section h3{margin:0 0 12px; font-size:1.1rem}
      .muted{color:var(--muted)}
      .small{font-size:.9rem; color:var(--muted)}
      .code{
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        font-size:.92rem; background: rgba(15,23,51,.45);
        border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:12px; overflow:auto;
      }

      /* Forms */
      label{font-weight:600; display:block; margin-bottom:8px}
      input[type="text"], input[type="number"], input[type="file"], button{
        width:100%; background: var(--card2); border:1px solid rgba(255,255,255,.14);
        color:var(--text); border-radius:12px; padding:10px 12px; font-size:1rem;
        transition: box-shadow .15s ease, border-color .15s ease, transform .02s ease;
      }
      input:focus, button:focus{
        outline:none; box-shadow: 0 0 0 3px rgba(122,162,255,.25); border-color: var(--accent)
      }
      input:hover{border-color: rgba(255,255,255,.25)}

      .grid-two{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
      .inputs{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
      @media (max-width: 980px){ .cards{grid-template-columns: 1fr 1fr} .inputs, .grid-two{grid-template-columns: 1fr} }
      @media (max-width: 640px){ .cards{grid-template-columns: 1fr} }

      /* Buttons / links */
      .actions{display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-top:14px}
      .btn{
        display:inline-flex; align-items:center; justify-content:center; gap:10px; padding:12px 16px; border-radius:12px;
        background:#76949F; color:#0b1021; border:0; font-weight:700; cursor:pointer;
        box-shadow: 0 10px 30px #6A6B83; transition: all 0.3s ease; text-decoration:none;
      }
      .btn:hover{transform: translateY(-1px); background:#86BBBD}
      .link{color:var(--muted); text-decoration:none}
      .link:hover{text-decoration:underline}

      .result{
        margin-top:12px; padding:12px; border-radius:12px;
        background: rgba(122, 162, 255, .10); border:1px solid rgba(122,162,255,.25);
      }
      .badge{display:inline-block; padding:4px 8px; border-radius:999px; background: rgba(122,162,255,.18); font-size:.85rem}
      .row{display:grid; grid-template-columns: 1fr 1fr; gap:16px}
      @media (max-width: 720px){ .row{grid-template-columns: 1fr} }
    </style>
  </head>
  <body>
    <div class="viewport">
      <div class="wrap">
        <!-- HERO -->
        <header class="page-hero">
          <h1>Final summary</h1>
          <p class="tagline">Your model is trained. Make single-row or batch predictions below.</p>
          <span class="pill">Final — Predict & export</span>
        </header>

        <!-- SUMMARY CARDS -->
        <section class="cards">
          <div class="card metric">
            <div class="label">Rows trained on</div>
            <div class="value">{{ summary.rows }}</div>
          </div>
          <div class="card metric">
            <div class="label">Model</div>
            <div class="value">{{ summary.model }}</div>
          </div>
          <div class="card metric">
            <div class="label">Target</div>
            <div class="value">{{ summary.target }}</div>
          </div>
          <div class="card metric">
            <div class="label"># Features</div>
            <div class="value">{{ summary.features|length }}</div>
          </div>
        </section>

        <!-- DETAILS -->
        <section class="section card">
          <h3>Training details</h3>
          <div class="row">
            <div>
              <div class="small">Feature columns</div>
              <div class="code" id="featCode">{{ summary.features|join(", ") }}</div>
              <div class="actions">
                <button type="button" class="btn" id="copyColsBtn">Copy column headers</button>
              </div>
            </div>
            <div>
              <div class="small">Hyperparameters & options</div>
              <pre class="code">{{ summary.params | tojson(indent=2) }}</pre>
              {% if summary.fs_method and summary.fs_method != 'none' %}
                <p class="small" style="margin-top:8px">
                  <span class="badge">Feature selection</span>
                  &nbsp;{{ summary.fs_method }} (C={{ summary.fs_C }})
                </p>
              {% endif %}
            </div>
          </div>
        </section>

        <!-- PREDICTIONS -->
        <section class="section">
          <div class="grid-two">
            <!-- SINGLE ROW -->
            <div class="card">
              <h3>Predict a single row</h3>
              <p class="small">Enter values for the features used during training.</p>
              <form method="post" action="/predict_one">
                <div class="inputs">
                  {% for f in features %}
                    <div>
                      <label for="fld_{{ f }}">{{ f }}</label>
                      {% if feature_types.get(f) == 'num' %}
                        <input id="fld_{{ f }}" type="number" step="any" name="{{ f }}" placeholder="Enter a number">
                      {% else %}
                        <input id="fld_{{ f }}" type="text" name="{{ f }}" placeholder="Enter text/category">
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
                <div class="actions">
                  <button type="submit" class="btn">Predict one</button>
                </div>
              </form>

              {% if single_pred is defined %}
                <div class="result">
                  <div class="small">Prediction</div>
                  <div style="font-size:1.2rem; font-weight:800">{{ single_pred }}</div>
                  {% if single_proba %}
                    <div class="small" style="margin-top:8px">Class probabilities</div>
                    <pre class="code" style="margin-top:6px">{{ single_proba | tojson(indent=2) }}</pre>
                  {% endif %}
                </div>
              {% endif %}
            </div>

            <!-- BATCH CSV -->
            <div class="card">
              <h3>Batch CSV</h3>
              <p class="small">Upload a CSV containing exactly these columns: <code>{{ features|join(", ") }}</code></p>
              <form method="post" action="/predict_csv" enctype="multipart/form-data">
                <label for="predict_file">Upload CSV</label>
                <input id="predict_file" type="file" name="predict_file" accept=".csv">
                <div class="actions">
                  <button type="submit" class="btn">Predict CSV</button>
                  <a class="btn" href="/template.csv">Download empty template</a>
                </div>
              </form>
            </div>
          </div>
        </section>

        <!-- NAV -->
        <section class="section">
          <a class="link" href="/">← Start over</a>
        </section>
      </div>
    </div>

    <script>
      // Copy features list to clipboard
      const copyBtn = document.getElementById('copyColsBtn');
      const featCode = document.getElementById('featCode');
      copyBtn?.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(featCode.textContent.trim());
          copyBtn.textContent = 'Copied!';
          setTimeout(()=> copyBtn.textContent = 'Copy column headers', 1200);
        } catch (e) {
          // noop
        }
      });
    </script>
  </body>
</html>
